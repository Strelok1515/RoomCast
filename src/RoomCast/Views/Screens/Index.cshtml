@model IEnumerable<RoomCast.Models.Casting.Screen>

@{
    ViewData["Title"] = "Screens";
}

<style>
    .rc-btn {
        display: inline-flex;
        align-items: center;
        gap: .4rem;
        padding: .45rem .8rem;
        border-radius: .5rem;
        font-size: .85rem;
        font-weight: 600;
        border: 1px solid transparent;
        background: #fff;
        transition: all .15s ease;
    }

        .rc-btn i {
            transition: inherit;
        }

    .rc-btn-outline-indigo {
        color: #3730a3;
        border-color: #c7d2fe;
    }

        .rc-btn-outline-indigo:hover {
            background: #eef2ff;
        }

    .rc-btn-outline-amber {
        color: #b45309;
        border-color: #fde68a;
    }

        .rc-btn-outline-amber:hover {
            background: #fef3c7;
        }

    .rc-btn-outline-rose {
        color: #b91c1c;
        border-color: #fecaca;
    }

        .rc-btn-outline-rose:hover {
            background: #fee2e2;
        }

    .rc-btn-outline-sky {
        color: #0369a1;
        border-color: #bae6fd;
    }

        .rc-btn-outline-sky:hover {
            background: #e0f2fe;
        }

    .rc-btn-outline-gray {
        color: #374151;
        border-color: #e5e7eb;
    }

        .rc-btn-outline-gray:hover {
            background: #f3f4f6;
        }

    .rc-btn-filled-indigo {
        background: #4f46e5;
        color: #fff;
    }

        .rc-btn-filled-indigo:hover {
            background: #4338ca;
        }
</style>


<div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-slate-800">Screens</h1>

    <a asp-action="Create" class="rc-btn rc-btn-filled-indigo">
        <i class="bi bi-plus-lg"></i> Add Screen
    </a>
</div>


@if (!Model.Any())
{
    <div class="rounded-2xl bg-white p-12 text-center shadow-sm">
        <i class="bi bi-tv text-5xl text-slate-400"></i>
        <h2 class="mt-4 text-xl font-semibold text-slate-700">No Screens Found</h2>
        <p class="mt-2 text-slate-500">Start by adding a screen.</p>

        <a asp-action="Create" class="rc-btn rc-btn-filled-indigo">
            <i class="bi bi-plus-lg"></i> Add Screen
        </a>
    </div>
}
else
{
    <div class="overflow-hidden rounded-xl bg-white shadow-sm">
        <table class="min-w-full divide-y divide-slate-200">
            <thead class="bg-slate-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-semibold">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold">Location</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold">Description</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold">Assigned</th>
                    <th class="px-6 py-3 text-center text-xs font-semibold">Actions</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-slate-100">
                @foreach (var screen in Model)
                {
                    <tr class="hover:bg-slate-50">

                        <!-- NAME -->
                        <td class="px-6 py-4 font-medium text-slate-800">
                            <i class="bi bi-tv" style="color:#6366f1;"></i>
                            @screen.Name
                        </td>

                        <!-- LOCATION -->
                        <td class="px-6 py-4 text-slate-600">
                            @screen.Location
                        </td>

                        <!-- DESCRIPTION -->
                        <td class="px-6 py-4 text-slate-600 max-w-xs">
                            <span>@screen.Description</span>
                        </td>

                        <!-- ASSIGNED -->
                        <td class="px-6 py-4 text-slate-700">
                            <div><strong>Media:</strong> @(screen.ScreenMediaAssignments?.Count ?? 0)</div>

                            <div class="mt-1">
                                <strong>Albums:</strong>
                                @if (screen.AlbumScreenAssignments?.Any() == true)
                                {
                                    <ul class="ml-4 list-disc text-slate-600">
                                        @foreach (var a in screen.AlbumScreenAssignments)
                                        {
                                            <li>@a.Album?.AlbumName</li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <span class="text-slate-500">None</span>
                                }
                            </div>
                        </td>

                        <!-- ACTION BUTTONS -->
                        <td class="px-6 py-4 text-center">
                            <div class="flex flex-wrap justify-center gap-2">

                                <a asp-action="AssignMedia" asp-route-id="@screen.ScreenId"
                                   class="rc-btn rc-btn-outline-indigo">
                                    <i class="bi bi-sliders"></i> Assign
                                </a>

                                <a asp-action="Edit" asp-route-id="@screen.ScreenId"
                                   class="rc-btn rc-btn-outline-amber">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>

                                <a asp-action="Delete" asp-route-id="@screen.ScreenId"
                                   class="rc-btn rc-btn-outline-rose">
                                    <i class="bi bi-trash"></i> Delete
                                </a>

                                <a asp-action="ScreenDisplay" asp-route-screenId="@screen.ScreenId"
                                   class="rc-btn rc-btn-outline-sky">
                                    <i class="bi bi-play-circle"></i> Preview
                                </a>

                                <!-- FIXED: START CASTING FORM + CSRF TOKEN -->
                                <form asp-controller="Screens"
                                      asp-action="StartCasting"
                                      method="post"
                                      class="inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="screenId" value="@screen.ScreenId" />
                                    <button type="submit" class="rc-btn rc-btn-outline-sky">
                                        <i class="bi bi-cast"></i> Start Casting
                                    </button>
                                </form>

                                <!-- FIXED: STOP CASTING -->
                                <form asp-controller="Screens"
                                      asp-action="StopCasting"
                                      method="post"
                                      class="inline">
                                    @Html.AntiForgeryToken()
                                    <button class="rc-btn rc-btn-outline-rose">
                                        <i class="bi bi-stop-circle"></i> Stop
                                    </button>
                                </form>

                                

                            </div>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>
}
